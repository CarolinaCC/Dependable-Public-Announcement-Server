syntax = "proto3";

package dpas.grpc.contract;

service ServiceDPAS {
    rpc register (RegisterRequest) returns (RegisterReply);
    rpc post (PostRequest) returns (PostReply);
    rpc postGeneral (PostRequest) returns (PostReply);
    rpc read (ReadRequest) returns (ReadReply);
    rpc readGeneral (ReadRequest) returns (ReadReply);
}

//
message RegisterRequest {
    bytes publicKey = 1;
    string username = 2;
}

//
enum RegisterStatus {
    REGISTERSTATUS_OK = 0;
    REGISTERSTATUS_NULL_USERNAME = 1;
    REGISTERSTATUS_NULL_PUBLICKEY = 2;
    REGISTERSTATUS_REPEATED_USER = 3;
}

//
message RegisterReply {
    RegisterStatus status = 1;
}

//
message UserBoardReference {
    int32 sequenceNumber = 1;
    bytes publicKey = 2;
}

//
message GeneralBoardReference {
    int32 sequenceNumber = 1;
}

//
message BoardReference {
    oneof reference {
        GeneralBoardReference generalBoardReference = 1;
        UserBoardReference userBoardReference = 2;
    }
}

//
message PostRequest {
    bytes publicKey = 1;
    string message = 2;
    string username = 3;
    bytes signature = 4;
    repeated BoardReference references = 5;
}

//
enum PostStatus {
    POSTSTATUS_OK = 0;
    POSTSTATUS_INVALID_MESSAGE_SIZE = 1;
    POSTSTATUS_NULL_USER = 2;
    POSTSTATUS_INVALID_SIGNATURE = 3;
    POSTSATATUS_INVALID_REFERENCE = 4;
    POSTSATATUS_NULL_PUBLIC_KEY = 5;

}

//
message PostReply {
    PostStatus status = 1;
}

//
message ReadRequest {
    bytes publicKey = 1;
    int32 number = 2;
    string username = 3;
}

enum readStatus {
     READ_OK = 0;
     INVALID_NUMBER_OF_POSTS_EXCEPTION = 3;
}

//
message ReadReply {
    repeated string announcements = 1;
    readStatus status = 2;
}
