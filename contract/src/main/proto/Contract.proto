syntax = "proto3";
import "google/protobuf/empty.proto";
package dpas.grpc.contract;

service ServiceDPAS {
    rpc register (RegisterRequest) returns (google.protobuf.Empty);
    rpc post (PostRequest) returns (google.protobuf.Empty);
    rpc postGeneral (PostRequest) returns (google.protobuf.Empty);
    rpc read (ReadRequest) returns (ReadReply);
    rpc readGeneral (ReadRequest) returns (ReadReply);
    rpc dhKeyExchange(ClientHello) returns (ServerHello);
    rpc dhFreshnessProof(ClientProof) returns (ServerProof);
    rpc safePost(SafePostRequest) returns (SafePostReply);
    rpc safePostGeneral(SafePostRequest) returns (SafePostReply);
    rpc safeRegister(SafeRegisterRequest) returns (SafeRegisterReply);
}


message ClientHello {
    bytes publicKey = 1;
    bytes dhKey = 2;
    bytes signature = 3;
}


message ServerHello {
    bytes seq = 1;
    bytes dhKey = 2;
    string keyId = 3;
    bytes signature = 4;
}


message ClientProof {
    bytes serverSeq = 1;
    bytes clientSeq = 2;
    bytes hmac = 3;
}


message ServerProof {
    bytes clientSeq = 1;
    bytes hmac = 2;
}


//
message RegisterRequest {
    bytes publicKey = 1;
}


//
message UserBoardReference {
    int32 sequenceNumber = 1;
    bytes publicKey = 2;
}

//
message GeneralBoardReference {
    int32 sequenceNumber = 1;
}

//
message PostRequest {
    bytes publicKey = 1;
    string message = 2;
    bytes signature = 3;
    repeated string references = 4;
}

message SafeRegisterRequest {
    bytes publicKey = 1;
    string keyId = 2;
    bytes seq = 3;
    bytes hmac = 4;
}

message SafeRegisterReply {
    bytes seq = 1;
    bytes hmac = 2;
}

//
message SafePostRequest {
    bytes publicKey = 1;
    bytes message = 2; //must be encrypted
    bytes signature = 3;
    repeated string references = 4;
    string keyId = 5;
    bytes seq = 6;
    bytes hmac = 7;
}

message SafePostReply {
    bytes seq = 1;
    bytes hmac = 2;
}

//
message ReadRequest {
    bytes publicKey = 1;
    int32 number = 2;
}

//
message ReadReply {
    repeated Announcement announcements = 1;
}

message Announcement {
    string message = 1;
    repeated string references = 3;
    bytes publicKey = 4;
    bytes signature = 5;
    int32 sequencer = 6;
    string hash = 7;
}

